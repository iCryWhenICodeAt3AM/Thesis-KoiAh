<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Experimentation</title>
    <link rel="stylesheet" href="css/master.css">
    <style>
        .responsive-table {
            width: 100%;
            border-collapse: collapse;
        }

        .results {
            max-height: 500px;
            height: 500px;
            overflow-y: auto;
            scrollbar-width: none;
        }

        .responsive-table th, .responsive-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .responsive-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .responsive-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .responsive-table tr:hover {
            background-color: #ddd;
        }

        .responsive-table {
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        .results {
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        #image-name {
            white-space: nowrap; 
            overflow-y: auto; 
            scrollbar-width: none;
            max-width: 40px;
        }
    </style>
</head>
<body>
    <div class="container-fluid text-center mt-2 p-4">
        <div class="row">
            <div class="cont-outer col-12 border border-3 border-dark">
                <h1>Hypothesis #1</h1>
            </div>
        </div>
        <div class="row">
            <div class="cont-outer col-4 mt-2 ms-5 p-4 border border-3 border-dark">
                <div class="row">
                    <div class="cont-inner col-12 border border-3 border-dark">
                        <h2>Small</h2>
                    </div>  
                </div>
                <div class="row mt-2 p-3">
                    <div class="cont-inner col-12 pt-2 pb-2 border border-3 border-dark">
                        <b>Ground Truth</b>
                        <div class="row">
                            <div class="col-12 mt-2">
                                <input type="file" id="smallFileInput" accept="application/json">
                            </div>
                        </div>
                    </div>
                    <div class="cont-inner col-12 mt-2 pb-2 pt-2 border border-3 border-dark">
                        <b>Images</b>
                        <div class="row">
                            <div class="col-12 mt-2">
                                <input type="file" id="smallImageInput" accept="image/*" multiple>
                            </div>
                            <div class="col-12 mt-2">
                                <button onclick="loadGroundTruth('small')">Load Image and Ground Truth</button>
                            </div>  
                        </div>
                    </div>
                    <div class="cont-inner col-12 mt-2 pb-2 pt-2 border border-3 border-dark">
                        <b>Predictions</b>
                        <div class="row">
                            <div class="col-12 mt-2">
                                <input type="file" id="smallPredictionInput" accept="application/json">
                            </div>
                            <div class="col-12 mt-2">
                                <button onclick="loadPredictions('small')">Load Small Predictions</button>
                            </div>  
                        </div>
                    </div>
                    <div class="cont-inner col-12 mt-2 pb-2 pt-2 border border-3 border-dark">
                        <b>Inputs Status</b>
                        <div class="row">
                            <div class="col-12">
                                <div id="smallInfo"></div>
                            </div>
                            <div class="col-12">
                                <div id="smallPredictionInfo"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cont-outer col-4 mt-2 ms-5 p-4 border border-3 border-dark">
                <div class="row">
                    <div class="cont-inner col-12 border border-3 border-dark">
                        <h2>Medium</h2>
                    </div>  
                </div>
                <div class="row mt-2 p-3">
                    <div class="cont-inner col-12 pt-2 pb-2 border border-3 border-dark">
                        <b>Ground Truth</b>
                        <div class="row">
                            <div class="col-12 mt-2">
                                <input type="file" id="mediumFileInput" accept="application/json">
                            </div>
                        </div>
                    </div>
                    <div class="cont-inner col-12 mt-2 pb-2 pt-2 border border-3 border-dark">
                        <b>Images</b>
                        <div class="row">
                            <div class="col-12 mt-2">
                                <input type="file" id="mediumImageInput" accept="image/*" multiple>
                            </div>
                            <div class="col-12 mt-2">
                                <button onclick="loadGroundTruth('medium')">Load Image and Ground Truth</button>
                            </div>  
                        </div>
                    </div>
                    <div class="cont-inner col-12 mt-2 pb-2 pt-2 border border-3 border-dark">
                        <b>Predictions</b>
                        <div class="row">
                            <div class="col-12 mt-2">
                                <input type="file" id="mediumPredictionInput" accept="application/json">
                            </div>
                            <div class="col-12 mt-2">
                                <button onclick="loadPredictions('medium')">Load Medium Predictions</button>
                            </div>  
                        </div>
                    </div>
                    <div class="cont-inner col-12 mt-2 pb-2 pt-2 border border-3 border-dark">
                        <b>Inputs Status</b>
                        <div class="row">
                            <div class="col-12">
                                <div id="mediumInfo"></div>
                            </div>
                            <div class="col-12">
                                <div id="mediumPredictionInfo"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cont-outer col-4 mt-2 ms-5 p-4 border border-3 border-dark">
                <div class="row">
                    <div class="cont-inner col-12 border border-3 border-dark">
                        <h2>Large</h2>
                    </div>  
                </div>
                <div class="row mt-2 p-3">
                    <div class="cont-inner col-12 pt-2 pb-2 border border-3 border-dark">
                        <b>Ground Truth</b>
                        <div class="row">
                            <div class="col-12 mt-2">
                                <input type="file" id="largeFileInput" accept="application/json">
                            </div>
                        </div>
                    </div>
                    <div class="cont-inner col-12 mt-2 pb-2 pt-2 border border-3 border-dark">
                        <b>Images</b>
                        <div class="row">
                            <div class="col-12 mt-2">
                                <input type="file" id="largeImageInput" accept="image/*" multiple>
                            </div>
                            <div class="col-12 mt-2">
                                <button onclick="loadGroundTruth('large')">Load Image and Ground Truth</button>
                            </div>  
                        </div>
                    </div>
                    <div class="cont-inner col-12 mt-2 pb-2 pt-2 border border-3 border-dark">
                        <b>Predictions</b>
                        <div class="row">
                            <div class="col-12 mt-2">
                                <input type="file" id="largePredictionInput" accept="application/json">
                            </div>
                            <div class="col-12 mt-2">
                                <button onclick="loadPredictions('large')">Load Large Predictions</button>
                            </div>  
                        </div>
                    </div>
                    <div class="cont-inner col-12 mt-2 pb-2 pt-2 border border-3 border-dark">
                        <b>Inputs Status</b>
                        <div class="row">
                            <div class="col-12">
                                <div id="largeInfo"></div>
                            </div>
                            <div class="col-12">
                                <div id="largePredictionInfo"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="cont-outer col-12 mt-3 border border-3 border-dark">
                <h2>Results</h2>
                <div class="results">
                    <table id="resultsTable" class="responsive-table">
                        <thead>
                            <tr>
                                <th>Image Name</th>
                                <th>Metric</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Results will be dynamically inserted here -->
                        </tbody>
                    </table>
                </div>
                <button class="mt-3 btn btn-primary" onclick="exportToExcel()">Export Results to Excel</button>
            </div>
        </div>
    </div>

    <script>
        let groundTruth = {
            small: [],
            medium: [],
            large: []
        };

        let predictions = {
            small: [],
            medium: [],
            large: []
        };

        function loadGroundTruth(size) {
            const input = document.getElementById(`${size}FileInput`);
            const file = input.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                const data = JSON.parse(event.target.result);
                groundTruth[size] = data;
                document.getElementById(`${size}Info`).innerText = `Loaded ${data.length} ground truth entries.`;
            };
            
            reader.readAsText(file);
        }

        function loadPredictions(size) {
            const input = document.getElementById(`${size}PredictionInput`);
            const file = input.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                const data = JSON.parse(event.target.result);
                predictions[size] = data;
                document.getElementById(`${size}PredictionInfo`).innerText = `Loaded ${data.length} predictions.`;
                updateResultsTable();
            };
            
            reader.readAsText(file);
        }

        function updateResultsTable() {
            const tableBody = document.getElementById('resultsTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = ''; // Clear existing rows

            const sizes = ['small', 'medium', 'large'];

            sizes.forEach(size => {
                const groundTruthData = groundTruth[size];
                const predictionData = predictions[size];

                groundTruthData.forEach((truth, index) => {
                    const prediction = predictionData[index];
                    if (prediction) {
                        const row = tableBody.insertRow();
                        const imageNameCell = row.insertCell(0);
                        const metricCell = row.insertCell(1);
                        const valueCell = row.insertCell(2);
                        
                        imageNameCell.innerText = truth.name;
                        metricCell.innerText = 'Metric'; // Replace with actual metric
                        valueCell.innerText = calculateMetric(truth, prediction); // Replace with actual metric calculation
                    }
                });
            });
        }

        function calculateMetric(groundTruth, prediction) {
            // Example metric calculation function. Replace with actual logic.
            return Math.abs(groundTruth.value - prediction.value);
        }

        function exportToExcel() {
            const table = document.getElementById('resultsTable');
            const wb = XLSX.utils.table_to_book(table, { sheet: "Sheet1" });
            const wbout = XLSX.write(wb, { bookType: "xlsx", type: "binary" });

            function s2ab(s) {
                const buf = new ArrayBuffer(s.length);
                const view = new Uint8Array(buf);
                for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
                return buf;
            }

            saveAs(new Blob([s2ab(wbout)], { type: "application/octet-stream" }), "results.xlsx");
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</body>
</html>